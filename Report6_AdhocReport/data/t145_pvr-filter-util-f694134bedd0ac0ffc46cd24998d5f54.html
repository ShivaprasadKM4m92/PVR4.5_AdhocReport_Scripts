//# sourceMappingURL=pvr-filter-util.js.map
var pvr=pvr||{};
pvr.filter_util=function(){var t=function(a){var e=[],b={};_.each(a,function(c){if(_.isUndefined(c.group))e.push(c);else{if(_.isNull(b[c.group])||_.isUndefined(b[c.group]))b[c.group]=[];b[c.group].push(c)}});return[e,b]},p=function(a){$(a).toggle("slide",{direction:"right",duration:300})},q=function(a){var e=u(a);p(a);return _.isEmpty(e)?"":e},u=function(a){var e=function(b,c,d,a,e){var f={};switch(b){case "range":f={type:"range",name:c};f["value"+a]=d;break;case "number-range":f={type:"number-range",
name:c};f["value"+a]=6E4*d;break;case "value":case "boolean":f={type:"value",name:c,value:d};break;case "enum":f={type:"enum",name:c,value:d,dataType:e};break;case "text":case "id":case "multi-value-id":case "manual":f={type:b,name:c,value:d}}return f};return _.reduce($(a+" .filter-input"),function(b,c){var d=$(c).data("type"),a=$(c).data("name");if(!(_.isNull(d)||_.isUndefined(d)||_.isNull(a)||_.isUndefined(a)))switch(d){case "date-range":var g=$(c).data("order"),d=$(c).val();_.isNull(d)||_.isUndefined(d)||
_.isEmpty(d)||(c=e("range",a,d,g),_.isNull(b[a])||_.isUndefined(b[a])?b[a]=c:b[a]=_.extend(b[a],c));break;case "number-range":g=$(c).data("order");d=$(c).val();_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(c=e("number-range",a,d,g),_.isNull(b[a])||_.isUndefined(b[a])?b[a]=c:b[a]=_.extend(b[a],c));break;case "select2-multi-id":d=$(c).select2("val");_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(c=e("multi-value-id",a,d),b[a]=c);break;case "text":d=$(c).val();_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||
(c=e("text",a,d),b[a]=c);break;case "select2-manual":d=$(c).val();_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(c=e("manual",a,d),b[a]=c);break;case "boolean":d=$(c).select2("val");c=e("boolean",a,d);_.isNull(d)||_.isEmpty(d)||(b[a]=c);break;case "select2-id":d=$(c).val();_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(c=e("id",a,d),b[a]=c);break;case "id":d=$(c).val();_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(c=e("id",a,d),b[a]=c);break;case "select2-enum":d=$(c).val();c=$(c).data("data-type");
_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(c=e("enum",a,d,-1,c),b[a]=c);break;default:d=$(c).val(),_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(c=e("value",a,d),b[a]=c)}return b},{})},v=function(){var a=_.find($(".filter-input"),function(a){a=$(a).val();return!(_.isEmpty(a)||_.isNull(a))});return!(_.isNull(a)||_.isUndefined(a))},m=function(a){var e=$(window).width();$(window).height();var b=$(".lib-filter").offset(),b=0>b.top?25:b.top+25,c=$(window).scrollTop();125<c&&(b=c);$(a).css("top",b+"px").css("width",
"400px").css("position","absolute").css("margin-left",e-400-10+"px")},n=function(a){a?$(".lib-filter").css("color","black"):$(".lib-filter").css("color","#999")},w=function(a,e){if(null===a)return"";for(var b=Math.ceil(a.length/e),c=Math.floor(12/e),d="",l=0;l<b;l++){for(var g="<div class='row'>",f=0,h;f<e;f++)h=l*e+f,g=h<a.length?g+('<div class="col-sm-'+c+'"><label class="col-sm-5" style="text-align: right;"><b>'+a[h].label+':</b></label><div class="col-sm-7" style="vertical-align: bottom">'+k(a[h])+
"</div></div>\n"):g+('<div class="col-sm-'+c+'"></div>');g+="</div>";d+=g+"\n"}return d},x=function(a,e){if(a){var b="",c=Math.floor(12/e);_.each(_.pairs(a),function(a){var e="";a=_.sortBy(a[1],function(a){return a.group_order});"number-range"==a[0].type?e+="<div class='row'><div class=\"col-sm-"+c+'"><label class="col-sm-5" style="text-align: right;"><b>'+a[0].label+':</b></label><div class="col-sm-3">'+k(a[0])+'</div><label class="col-sm-1" style="text-align: right;">'+a[1].label+'</label><div class="col-sm-3">'+
k(a[1])+"</div></div>\n</div>\n":_.each(a,function(a){e+="<div class='row'><div class=\"col-sm-"+c+'"><label class="col-sm-5" style="text-align: right;"><b>'+a.label+':</b></label><div class="col-sm-7">'+k(a)+"</div></div>\n</div>\n"});b+=e});return b}return""},k=function(a){var e=function(a){var b="";$.ajax({url:a.ajax.url,async:!1,success:function(e){b=a.ajax.data_handler(e)},error:function(b){a.ajax.error_handler(b)}});return b},b="";switch(a.type){case "boolean":b="data-name='"+a.name+"' data-type='"+
a.type+"'";b="<select style='width: 100%;' id='testselect' class='filter-input form-control filter-select2' "+b+">\n<option value=''></option>\n<option value='true'>True</option>\n";b+="<option value='false'>False</option>\n";b+="</select>";break;case "date-range":b="data-name='"+a.group+"' data-type='date-range' data-order='"+a.group_order+"'";b="<div>"+pvr.common_util.render_tmpl("datepicker",{id:"tmp-id",title:"Title",cls:"filter-date-picker",extra_attrs:b})+"</div>";break;case "select":b="<select style='width: 100%;' data-name='"+
a.name+"' data-type='"+a.type+"'>";a.ajax&&(b+=e(a));b+="</select>";break;case "select2":case "select2-id":b="<select style='width: 100%;' class='filter-input form-control filter-select2' data-name='"+a.name+"' data-type='"+a.type+"'>";a.ajax&&(b+=e(a));b+="</select>";break;case "select2-manual":case "select2-enum":b="<select style='width: 100%;' data-name='"+a.name+"' class='filter-input form-control filter-select2' data-type='"+a.type+"' data-data-type='"+a.data_type+"'>";b+=r(a.data,"key","value",
!0);b+="</select>";break;case "select2-multi-id":b="<select style='width: 100%;' data-name='"+a.name+"' class='filter-input form-control filter-select2' multiple='multiple' data-type='"+a.type+"'>";a.ajax&&(a=e(a),b+=a);b+="</select>";break;case "number-range":b="<input class='filter-input form-control' style='width:100%' data-type='"+a.type+"' type='number' data-name='"+a.group+"' data-order= '"+a.group_order+"' onkeypress='return (event.keyCode >47 && event.keyCode <58)' min='0'>";break;case "number":b=
"<input class='filter-input form-control' style='width:100%' data-type='"+a.type+"' type='number' data-type='"+a.type+"'  data-name='"+a.name+"' onkeypress='return (event.keyCode >47 && event.keyCode <58)' min='0'>";break;default:b="<input class='filter-input form-control' style='width: 100%' data-type='"+a.type+"'  data-name='"+a.name+"'>"}return b},r=function(a,e,b,c){var d=c?"<option value=''></option>\n":"";_.each(a,function(a){d+="<option value='"+a[e]+"'>"+a[b]+"</option>\n"});return d};return{construct_right_filter_panel:function(a){var e=
a.container_id,b=a.column_count,c=a.done_func,d=t(a.filter_defs);a=w(d[0],b);b=x(d[1],b);b=pvr.common_util.render_tmpl("filter_panel",{id:e,filter_body:a+b});b=$.parseHTML(b);$("body").append(b);$(".filter-select2").select2({allowClear:!0});$(".filter-date-picker").datepicker({allowPastDates:!0,date:null,momentConfig:{culture:userLocale,format:DEFAULT_DATE_DISPLAY_FORMAT}});$(".datepicker input.form-control").addClass("filter-input");$("#"+e).find(".apply-button").click(function(a){a.preventDefault();
a=q("#"+e);c(a);v()?n(!0):n(!1);return!1});$("#"+e).find(".clear-button").click(function(a){a.preventDefault();a="#"+e;$(a).find(".filter-input").val("");$(a).find("input.filter-input[type='checkbox']").removeAttr("checked");$(".filter-select2").select2("val","");n(!1);return!1});$("#"+e).find("input.filter-input").keypress(function(a){if(13==a.which)return a.preventDefault(),c(q("#"+e)),!1});m("#"+e);$("#"+e).hide();(function(){$(".lib-filter").click(function(){$(e).is(":visible")?p("#"+e):$("#"+
e).toggle("slide",{direction:"right",duration:300})})})();$("#mainContent,.topbar,#sidebar-menu").click(function(){$("#"+e).hide()});$(window).on("resize",function(a){m("#"+e)});$(window).on("scroll",function(a){m("#"+e)})},build_options:r}}();